(function(e,t){typeof exports==`object`&&typeof module<`u`?module.exports=t():typeof define==`function`&&define.amd?define([],t):(e=typeof globalThis<`u`?globalThis:e||self,e.DOMShield=t())})(this,function(){let{createCSPMonitor:e}=class e{config;isEnabled=!1;reportQueue=[];constructor(e=`/csp-violations`){this.config=Object.freeze({endpoint:e,maxQueueSize:100}),this.initializeSecurityMonitoring()}static createCSPMonitor(t=`/csp-violations`){return new e(t)}initializeSecurityMonitoring(){document.addEventListener(`securitypolicyviolation`,this.handleSecurityPolicyViolation),console.log(`üõ°Ô∏è DOM Shield CSP Monitor initialized`),console.log(`üìç Reports will be sent to: ${this.config.endpoint}`)}handleSecurityPolicyViolation=async e=>{let t=e,n=this.createViolationReport(t);console.warn(`üö® CSP Violation detected:`,n),this.queueReport(n),this.isEnabled&&await this.sendReportToEndpoint(n)};createViolationReport(e){let t=Object.freeze({"blocked-uri":e.blockedURI||``,"document-uri":e.documentURI||``,"effective-directive":e.effectiveDirective||``,"original-policy":e.originalPolicy||``,referrer:e.referrer||``,"script-sample":e.sample||``,"status-code":e.statusCode||0,"violated-directive":e.violatedDirective||``});return Object.freeze({timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,violation:t,additionalInfo:{lineNumber:e.lineNumber,columnNumber:e.columnNumber,sourceFile:e.sourceFile}})}queueReport(e){let t=[...this.reportQueue,e];this.reportQueue=Object.freeze(t.length>this.config.maxQueueSize?t.slice(1):t)}async sendReportToEndpoint(e){try{let t=await fetch(this.config.endpoint,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify(e)});return t.ok?(console.log(`‚úÖ CSP violation report sent successfully`),!0):(console.error(`‚ùå Failed to send CSP report:`,t.status),!1)}catch(e){return console.error(`‚ùå Error sending CSP report:`,e),!1}}async processQueuedReportsForSending(){if(this.reportQueue.length===0){console.log(`üì≠ No queued reports to send`);return}console.log(`üì§ Sending ${this.reportQueue.length} queued reports...`);let e=[];for(let t of this.reportQueue)await this.sendReportToEndpoint(t)||e.push(t);this.reportQueue=Object.freeze(e)}enableMonitoring(){this.isEnabled=!0,console.log(`‚úÖ CSP monitoring enabled`),this.reportQueue.length>0&&(console.log(`üì§ Sending ${this.reportQueue.length} queued reports...`),this.reportQueue.forEach(e=>this.sendReportToEndpoint(e)))}disableMonitoring(){this.isEnabled=!1,console.log(`‚è∏Ô∏è CSP monitoring disabled`)}getQueuedReports(){return this.reportQueue}clearReportQueue(){let e=this.reportQueue.length;this.reportQueue=Object.freeze([]),console.log(`üóëÔ∏è Cleared ${e} queued CSP reports`)}async sendQueuedReports(){await this.processQueuedReportsForSending()}getMonitoringStatus(){return Object.freeze({enabled:this.isEnabled,endpoint:this.config.endpoint,queuedReports:this.reportQueue.length,maxQueueSize:this.config.maxQueueSize})}},{executeElementDetectionRule:t}=class e{rule;selector;constructor(e){this.selector=e,this.rule=`ElementDetection:${e}`}static executeElementDetectionRule({selector:t}){new e(t).execute()}execute(){let e=this.findTargetElement();this.logDetectionResult(e)}findTargetElement(){return document.querySelector(this.selector)}logDetectionResult(e){e?this.logSuspiciousElement():this.logCheckPassed()}logSuspiciousElement(){console.log(`üö® DOM Shield: ${this.rule} detected!`),console.warn(`Potentially suspicious element found: ${this.selector}`)}logCheckPassed(){console.log(`‚úÖ DOM Shield: ${this.rule} check passed`)}},{executeIframeDetection:n}=class e{rule=`IframeDetection`;constructor(){}static executeIframeDetection(){new e().execute()}execute(){let e=this.getAllIframes();this.logIframeResults(e)}getAllIframes(){return document.querySelectorAll(`iframe`)}logIframeResults(e){e.length>0&&(console.log(`üîç DOM Shield: Found ${e.length} iframe(s)`),e.forEach((e,t)=>this.logIframeInfo(e,t)))}logIframeInfo(e,t){let n=e.src||`No src attribute`;console.log(`  Iframe ${t+1}: ${n}`)}},{executeSuspiciousScriptsRule:r}=class e{rule;suspiciousDomains;constructor(e=[]){this.rule=this.buildRuleName(e),this.suspiciousDomains=e}static executeSuspiciousScriptsRule({domains:t}){new e(t).execute()}execute(){this.getAllScriptsWithSrc().forEach(e=>this.checkScriptSecurity(e))}buildRuleName(e){return e.length>0?`SuspiciousScripts:${e.join(`,`)}`:`SuspiciousScripts`}getAllScriptsWithSrc(){return document.querySelectorAll(`script[src]`)}checkScriptSecurity(e){this.suspiciousDomains.some(t=>e.src.includes(t))&&console.warn(`üö® DOM Shield: Suspicious script detected:`,e.src)}},{executeLiveElementDetectionRule:i}=class e{rule;selector;observer=null;constructor(e){this.selector=e,this.rule=`LiveElementDetection:${e}`}static executeLiveElementDetectionRule({selector:t}){new e(t).execute()}execute(){this.observer=new MutationObserver(this.handleMutations),this.observer.observe(document.body,{childList:!0,subtree:!0}),console.log(`‚úÖ DOM Shield: Started real-time monitoring for '${this.selector}'`)}handleMutations=e=>{for(let t of e){if(t.type!==`childList`)continue;t.addedNodes.forEach(e=>this.checkNode(e))}};checkNode(e){if(e.nodeType!==Node.ELEMENT_NODE)return;let t=e;(t.matches(this.selector)||t.querySelector(this.selector))&&this.logSuspiciousElement()}logSuspiciousElement(){console.log(`üö® DOM Shield: ${this.rule} detected!`),console.warn(`Suspicious element added to the DOM: ${this.selector}`)}disconnect(){this.observer&&(this.observer.disconnect(),this.observer=null,console.log(`‚úÖ DOM Shield: Stopped real-time monitoring for '${this.selector}'`))}},a=e=>{for(let a of e)switch(a.type){case`element`:t({selector:a.selector});break;case`iframe`:n();break;case`scripts`:r({domains:a.domains});break;case`live-element`:i({selector:a.selector});break}};var o=null,s=!1;function c(t){if(t){if(o){console.warn(`‚ö†Ô∏è CSP Monitor instance already exists. Using existing instance.`),t.enable!==void 0&&(t.enable?(o.enableMonitoring(),console.log(`‚úÖ CSP Monitoring re-enabled`)):console.log(`‚è∏Ô∏è CSP Monitoring disabled on re-initialization`));return}o=e(t.endpoint),t.enable?(o.enableMonitoring(),console.log(`‚úÖ CSP Monitoring enabled`)):console.log(`‚è∏Ô∏è CSP Monitoring configured but disabled`)}}function l(e){e&&(a(e),console.log(`‚úÖ ${e.length} integrity rules executed`))}return{init(e){if(s){console.warn(`‚ö†Ô∏è DOM Shield already initialized. Skipping re-initialization.`);return}e.csp&&c(e.csp),e.integrity&&l(e.integrity),s=!0,console.log(`üõ°Ô∏è DOM Shield initialized successfully`)},getCSPMonitor(){return o},reset(){o=null,s=!1,console.log(`üîÑ DOM Shield reset`)},isInitialized(){return s}}});